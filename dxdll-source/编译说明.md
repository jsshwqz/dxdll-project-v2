# 编译 DXDLL - 详细步骤

## ✅ 代码修改已完成

已成功在 `proxydll.cpp` 第1731行添加剪贴板功能代码！

**修改内容：**
- 添加了 `OpenClipboard()`、`SetClipboardData()` 等 Windows API
- 图像格式转换（D3D BGRA → DIB BGRA）
- 垂直翻转逻辑（D3D自顶向下 → DIB自底向上）
- 全局内存管理（GlobalAlloc/GlobalLock）

**备份文件：** `proxydll.cpp.backup`

---

## 📦 编译准备

### 方案1：使用 Visual Studio 2022（推荐）

#### 1. 安装 Visual Studio 2022

下载地址：https://visualstudio.microsoft.com/zh-hans/downloads/

**必需组件：**
- ✅ "使用 C++ 的桌面开发"
- ✅ "Windows 10 SDK"
- ✅ "MSVC v143 - VS 2022 C++ x64/x86 生成工具"

#### 2. 打开项目

1. 导航到：`e:\Program Files\OperationFlashpoint\Dxdll - 副本\dxdll-source\`
2. 双击 `DX8Hook.sln`
3. Visual Studio 会提示升级项目，点击"确定"

#### 3. 配置项目

**平台：** Win32（32位，不是 x64）  
**配置：** Release

右键项目 → 属性，确认：
- 平台工具集：v143 或更高
- Windows SDK 版本：10.0（最新）
- 配置类型：动态库 (.dll)

#### 4. 编译

1. 菜单：生成 → 生成解决方案（Ctrl+Shift+B）
2. 查看输出窗口，等待编译完成

#### 5. 查找输出文件

编译成功后，DLL 位于：
```
dxdll-source\Release\d3d8.dll
```

---

### 方案2：使用 MSBuild 命令行

如果已安装 Visual Studio，可以用命令行编译：

```powershell
# 打开 Developer Command Prompt for VS 2022
cd "e:\Program Files\OperationFlashpoint\Dxdll - 副本\dxdll-source"

# 升级项目（可选）
devenv DX8Hook.sln /Upgrade

# 编译
msbuild DX8Hook.sln /p:Configuration=Release /p:Platform=Win32
```

---

## ⚠️ 可能的编译问题

### 问题1：找不到SDK或头文件

**错误：** `无法打开包栝文件: "windows.h"`

**解决：**
1. 打开 Visual Studio Installer
2. 修改 → 勾选 "Windows 10 SDK"
3. 安装后重启 VS

### 问题2：平台不匹配

**错误：** `error LNK1112: 模块计算机类型"x64"与目标计算机类型"x86"冲突`

**解决：**
- 确保平台设置为 **Win32**，不是 x64

### 问题3：无法打开 d3d8.h

**错误：** `cannot open include file: 'd3d8.h'`

**解决：**
- d3d8.h 已包含在项目中，检查文件是否存在：
  ```
  dxdll-source\d3d8.h
  ```

---

## 🔄 部署新 DLL

编译成功后：

1. **复制新DLL：**
   ```powershell
   Copy-Item "dxdll-source\Release\d3d8.dll" "d3dx.dll" -Force
   ```

2. **备份旧DLL：**
   ```powershell
   Copy-Item "d3dx.dll" "d3dx.dll.old" -Force
   ```

3. **测试：**
   - 启动游戏
   - 按 `Print Screen` 截图
   - 打开 QQ/微信
   - 按 `Ctrl+V` 粘贴

---

## 🎯 下一步

根据你的情况：

1. **有 Visual Studio** → 按方案1编译
2. **想用命令行** → 按方案2编译
3. **没有编译环境** → 告诉我，我可以提供其他方案

**准备好了吗？** 告诉我你是否已安装 Visual Studio，或需要帮助安装！
